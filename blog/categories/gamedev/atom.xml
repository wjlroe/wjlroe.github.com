<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: gamedev | Will Roe&#146;s blog]]></title>
  <link href="http://blog.wjlr.org.uk/blog/categories/gamedev/atom.xml" rel="self"/>
  <link href="http://blog.wjlr.org.uk/"/>
  <updated>2017-03-19T00:15:29+00:00</updated>
  <id>http://blog.wjlr.org.uk/</id>
  <author>
    <name><![CDATA[Will Roe]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[The Module Pattern in Javascript]]></title>
    <link href="http://blog.wjlr.org.uk/2015/04/04/js-module-pattern.html"/>
    <updated>2015-04-04T09:00:00+01:00</updated>
    <id>http://blog.wjlr.org.uk/2015/04/04/js-module-pattern</id>
    <content type="html"><![CDATA[<p>Javascript has a liberal array of techniques for constructing objects.
Although object oriented style programming can be simulated in
Javascript (which is prototypical in nature), it can get a little
unwieldy.</p>

<!--more-->


<h2>Pseudoclassical OO</h2>

<p>The following code is in the style referred to as pseudoclassical by
Douglas Crockford in <a href="http://shop.oreilly.com/product/9780596517748.do">Javascript: The Good Parts</a>:</p>

<pre><code class="javascript">var Person = function(name, empathy) {
    this.name = name;
    this.empathy = empathy || 0;
};

Person.prototype.get_name = function() {
    return this.name;
};

Person.prototype.get_empathy = function() {
    return this.empathy;
};

Person.prototype.change_empathy = function(amount) {
    this.empathy = this.empathy + amount;
    return this.empathy;
};

Person.prototype.status = function() {
    return this.get_name() + " has " + this.get_empathy() + " empathy";
};

var Player = function(name, empathy) {
    this.name = name;
    this.empathy = empathy || 0;
};

Player.prototype = new Person();

var Mob = function(name, empathy) {
    this.name = name;
    this.empathy = empathy || 0;
};

Mob.prototype = new Person();
</code></pre>

<p>And we can use the &#8216;classes&#8217; like so:</p>

<pre><code class="javascript">var player = new Player("Ada", 100);
console.log(player.status()); // 'Ada has 100 empathy'

var mob = new Mob("Bob", -10);
console.log(mob.status()); // 'Bob has -10 empathy'

mob.change_empathy(2);
console.log(mob.status()); // 'Bob has -8 empathy'
</code></pre>

<p>There are a few things to note here:</p>

<ul>
<li>There are no private fields or methods, it&#8217;s not feasible to add them</li>
<li>There is duplication in constructors that lie in an inheritance chain
(i.e. where an object&#8217;s prototype is set to another object)</li>
<li>It&#8217;s horribly verbose (a matter of personal taste however)</li>
<li>Due to the lack of private fields, you can&#8217;t have a method called
<code>name()</code> that returns a field called <code>name</code> - one will overwrite the
other in this style</li>
</ul>


<h2>The limits of inheritance</h2>

<p>Even ignoring these issues (and there are other ways to create objects
that work around this limitation), object oriented inheritance is not
the most flexible way to design software. For many domains of
problems, composition or augmentation trumps inheritance. Let&#8217;s
examine a motivating example. In the following class diagram we have
some domain objects for a game. Players and Mobs are Person(s),
Person(s) and Rucksacks are Objects. All is well with this view of the
world, no code is duplicated between objects and it all works as
intended.</p>

<p><img class="extrawide"
src="http://blog.wjlr.org.uk/images/components-before-container-extraction.png" title="Class
object diagram"></p>

<p>Here are some unit tests of these objects to illustrate their functionality:</p>

<pre><code class="javascript">var JS = require("jstest"),
    components = require("../lib/components");

JS.Test.describe("components", function() {
    this.before(function() {
        this.rucksack = components.rucksack({name: "Bag of Holding"});
        this.another_rucksack = components.rucksack({name: "Bigger bag"});
        this.spell = components.spell({name: "Potion of empathy"});
    });

    this.describe("container", function() {
        this.it("can contain other containers", function() {
            this.rucksack.add(this.spell);
            this.another_rucksack.add(this.rucksack);
            this.assertEqual(1, this.another_rucksack.quantity());
            this.assertEqual("Bag of Holding",
                             this.another_rucksack.items()[0].name());
        });
        this.it("can contain other objects", function() {
            this.rucksack.add(this.spell);
            this.assertEqual(1, this.rucksack.quantity());
            this.assertEqual("Potion of empathy",
                             this.rucksack.items()[0].name());
        });
    });
});
</code></pre>

<p>Now say we want to extend our player objects to have an inventory (or
<code>container</code>). We could approach this in a number of ways but
inheritance is not one of them. We already have <code>rucksack</code> and
<code>person</code> inheriting from <code>object</code> so we can&#8217;t just create <code>container</code>
as a superclass of those. We need a way to extend both those objects
and extract the <code>container</code>-related behaviour and state so we don&#8217;t
have code duplication. In Ruby, we might create <code>container</code> as a
<code>Module</code> and <code>include</code> it in our classes.</p>

<p>The method pattern in JS allows us to do something quite similar, but
first, let&#8217;s write a failing test:</p>

<pre><code class="javascript">this.describe("player", function() {
    this.it("has an inventory", function() {
        this.assertEqual(0, this.player.quantity());
        this.player.add(this.spell);
        this.assertEqual(1, this.player.quantity());
        this.assertEqual("Potion of empathy", this.player.items()[0].name());
    });
});
</code></pre>

<h2>The Module Pattern</h2>

<p>Now we can go ahead and examine how to construct the relationship
between objects that we need. This diagram approximates the idea (I&#8217;m
not exactly clear what options to pass GraphViz to make the
<code>container</code> obviously indicate it is included as a module):</p>

<p><img class="extrawide"
src="http://blog.wjlr.org.uk/images/components-after-container-extraction.png" title="Class
object diagram with container component"></p>

<p>The basic &#8216;shape&#8217; of an object using &#8216;functional composition&#8217; looks
like the following:</p>

<pre><code class="javascript">var object = function(spec) {
    var that = {};

    that.name = function() {
        return spec.name;
    };

    return that;
};
</code></pre>

<p>The <code>spec</code> argument is the object to be augmented (sometimes that&#8217;s as
simple as being the parent object). The <code>that</code> object which gets
returned constitutes the public interface that this object returns.
Because <code>spec</code> is passed in and <code>that</code> is returned, this <code>object</code>
constructor is a base class.</p>

<p>The <code>container</code> constructor function looks like this:</p>

<pre><code class="javascript">var container = function(that) {
    var inventory = [];

    that.add = function(item) {
        inventory.push(item);
    };

    that.quantity = function() {
        return inventory.length;
    };

    that.items = function() {
        return inventory;
    };

    return that;
};
</code></pre>

<p>Unlike the previous example, <code>container</code> exists to decorate the
provided object with more functionality. If you needed to provide
defaults for this object specifically, you can pass a <code>spec</code> argument
in also but it wasn&#8217;t necessary here. Crucially, the <code>inventory</code>
variable is <a href="https://en.wikipedia.org/wiki/Scope_(computer_science)#Lexical_scope_vs._dynamic_scope">lexically scoped</a> to the <code>container</code> constructor, meaning
no code gets access to it except that inside the <code>container</code>
constructor. This is in contrast to <code>Modules</code> in Ruby where
everything, fields and all, gets included into a <code>Class</code> and becomes
part of that class.</p>

<p>The <code>person</code> object is a little different:</p>

<pre><code class="javascript">var person = function(spec) {
    var that = container(object(spec)),
        empathy = spec.empathy || 0;

    that.change_empathy = function(amount) {
        empathy = empathy + amount;
    };
    that.empathy = function() {
        return empathy;
    };

    return that;
};
</code></pre>

<p>We&#8217;re back to using a <code>spec</code> argument here so that we can instantiate
a <code>person</code> with some default amount of empathy. The <code>that =
container(object(spec))</code> stands in for traditional object inheritance.</p>

<p>After we&#8217;ve created the <code>container</code> object and wired it up to <code>person</code>
and <code>rucksack</code>, the code for concrete objects in our toy example looks
like this:</p>

<pre><code class="javascript">module.exports.rucksack = function(spec) {
    var that = container(object(spec));
    return that;
};

module.exports.mob = function(spec) {
    var that = person(spec);
    return that;
};

module.exports.player = function(spec) {
    var that = person(spec);
    return that;
};

module.exports.spell = function(spec) {
    var that = object(spec);

    that.affect = function(obj) {
        if (that.inRange(obj)) {
            obj.change_empathy(1);
        }
    };

    return that;
};
</code></pre>

<p>Although the diagram above implies a strict inheritance hierarchy,
that is not necessarily the case. The difference between <code>object</code> and
<code>container</code> is subtle, with <code>object</code> hiding the <code>spec</code> object and
returning a new object (just as <code>person</code> and <code>rucksack</code> do), whereas
<code>container</code> just adds methods to an object.</p>

<p>One last thing! It might be apparent, but it&#8217;s worth calling out the
other advantage this gives us: dynamic runtime extensions. If you want
the <code>spell</code> object to be able to contain items, you could do so at any
stage, running:</p>

<pre><code class="javascript">var my_spell = spell({name: "Confusing potion"});
// my_spell doesn't have an inventory
container(my_spell);
console.log(my_spell.quantity()); // '0'
</code></pre>

<p>This code modifies the <code>my_spell</code> variable, but no other variables
that use the <code>spell</code> constructor function. This could be useful in
games where items can interact, giving each other different
functionality (e.g. imagine a potion that allows bookcases to float or
drinking a flying potion adds the <code>flying</code> component to a player). In
those cases, there&#8217;s no need for complex if/else/switch-style
programming, just augment the object with the desired module
and that&#8217;s it!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ludum Dare 31 Postmortem]]></title>
    <link href="http://blog.wjlr.org.uk/2014/12/08/ludum-dare-31-postmortem.html"/>
    <updated>2014-12-08T20:01:00+00:00</updated>
    <id>http://blog.wjlr.org.uk/2014/12/08/ludum-dare-31-postmortem</id>
    <content type="html"><![CDATA[<p>On the weekend of 6th December 2014, I participated in <a href="http://ludumdare.com/compo/">Ludum Dare</a> 31. The theme was &#8220;Entire Game on One Screen&#8221;. I didn&#8217;t finish my game and didn&#8217;t hand anything in. This is the 3rd(?) time I&#8217;ve started but not finished a Ludum Dare game in recent years. The first time I participated in Ludum Dare, I completed a game and handed it in for the competition (48 hours), so I&#8217;m curious as to what has been holding me back since then.</p>

<!--more-->


<p><img src="http://blog.wjlr.org.uk/images/robot-scene.png" class="extrawide pixel-art"></p>

<h2>Lack of planning</h2>

<p>It was only after Ludum Dare was completed and I filled in a <a href="http://trello.com">Trello</a> board with the tasks necessary to complete my game that I realised the immensity of the project. I was reading <a href="https://twitter.com/amyhoy">Amy Hoy&#8217;s</a> new book <a href="https://unicornfree.com/just-fucking-ship">Just Fucking Ship</a> and it emphasises working backwards from a goal to a set of tasks that need to be done. Hoy also advocates <a href="http://en.wikipedia.org/wiki/Mise_en_place">Mise en place</a> style of working, which I&#8217;ve never identified as a <em>thing</em> before but it&#8217;s obvious in hindsight. Ludum Dare advice usually contains something about starting on paper, getting all the high-level details worked out before diving into code and that&#8217;s absolutely right. The other massive advantage of having a todo list (e.g. in Trello) is that it&#8217;s super easy to order the list of things in terms of what needs to be done and what is optional. Does it matter that the resolution is fixed at 800x600? Nope. But I&#8217;ve totally sunk hours/days into coding around the idea I need to have a scalable interface on the web for my games (and it&#8217;s always really painful).</p>

<p><img src="http://blog.wjlr.org.uk/images/Elm_Editor_Mario.png" class="extrawide"></p>

<p>Case in point - this Ludum Dare, I decided to use <a href="http://elm-lang.org">Elm</a>, which was entirely new to me. The conventional wisdom has it that one should never learn tools while participating in Ludum Dare, just use whatever you have at hand (i.e. programming languages/IDEs/libraries etc. that you have used extensively before). I only make games during Ludum Dare though and I&#8217;ve never reached a level of proficiency with gamedev that I feel leaves me with a default technology choice, so I used a new thing. However, this time round, using Elm, the web game ends up getting drawn using the 2D canvas and image elements positioned on top of it basically. You can&#8217;t control a lot of how Elm does any of this and there was a minor wrinkle - there&#8217;s no way to use CSS&#8217;s <a href="https://developer.mozilla.org/en/docs/Web/CSS/image-rendering">image-rendering</a> option to optimise for pixel art (crisp-edges is what you want - which is essentially nearest-neighbour scaling up/down). The result is you get blurry pixel art in your games and this sucks. It&#8217;s not at all a blocking problem for Ludum Dare games though and I feel silly for spending any more than 5 minutes on it.</p>

<h2>Overly ambitious game design</h2>

<p>I&#8217;m not a regular gamedev, this is something I do very occasionally. I&#8217;m a software engineer and therefore I completely and wildly underestimate the complexity and difficulty of programming tasks. Not to mention my total lack of ability to gauge time requirements. In the world of work, many of us software engineers avoid the near-impossible task of time estimation by using Agile-based practice and estimating complexity instead. It&#8217;s entirely based on teamwork and iteration of process and makes no sense for an individual working towards a goal on a deadline.</p>

<p>Aside: within the confines of Agile processes and teams, individuals can and do use more &#8220;traditional&#8221; time estimation and tracking tools to live up to their own expectations of themselves, so we do think &#8220;this will probably take half a day&#8221; but the discipline of working in an Agile team is never externalising that because it becomes an expectation and a commitment.</p>

<p>All my weaknesses as a software engineer aside, I made the fundamental error of dreaming up a cool game that was not within my reach of a 48 hour deadline. This is a completely avoidable self-imposed problem. The solution seems to be, sketch out the game in its entirety - all the objects in the game, all the components and all the behaviour. Make sure you have all the artwork at least approximated (I did this in Paper on the iPad because I could doddle on that while watching TV and it didn&#8217;t even feel like work). At this point you can identify elements that can be left out - think &#8220;what could I postpone if I was forced to launch this in an hour?&#8221; - or some other mind trick to force yourself to be ruthless with the scope of your game. One advantage of sketching everything on paper or in Paper on an iPad is that if time gets really tight and you don&#8217;t have super great pixel artwork ready - just chop up/scan in/photograph the sketches and use them as your assets. There will be people playing your game who think the hand-drawn nature of the artwork was a stylistic choice you made from the beginning and you know you ran out of time.</p>

<p><img src="http://blog.wjlr.org.uk/images/sketching-onescreen.png" class="extrawide"></p>

<h2>Onwards</h2>

<p>So now I have a Trello board that makes it embarrassingly clear how unrealistic my game was for a 48 hour competition - where do I go from here? I think the best answer to that is to carry on with it, attack each task in the list and then realise the game is done (that sounds obvious but it&#8217;s impossible to realise when you&#8217;re ready to ship something unless you define up-front what you actually want to ship).</p>

<p>In Agile circles, we talk a bit about what it means to be Done. The &#8220;definition of done&#8221;, which can sound rather alien to somebody who&#8217;s not familiar with specifying that concretely. It&#8217;s essential to working progress otherwise you end up with tasks that linger on for days and weeks because they are quite simply never finished. Those aren&#8217;t tasks, they&#8217;re a waking nightmare. Sometimes there is no definition of done. This blog post doesn&#8217;t have a definition of done because I made an agreement with myself that I would write until I felt hungry then I would order some food. In Agile that&#8217;s usually called time-boxing and it usually isn&#8217;t hunger-based but might as well be. &#8220;Let&#8217;s time-box this for an hour&#8221; is a common phrase in Agile teams. It&#8217;s how you manage investigation tasks (otherwise they go on forever). We all need more, clearer definitions of done.</p>

<p><img src="http://blog.wjlr.org.uk/images/hunger-box.png" class="extrawide"></p>

<p>So Ludum Dare is over. I&#8217;m done with this blog post. I have plenty to practice and improve before next Ludum Dare and with any luck I&#8217;ll ship a game next time.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ludum Dare 24 - I'm taking part]]></title>
    <link href="http://blog.wjlr.org.uk/2012/08/22/ludum-dare-24-i-slash-m-taking-part.html"/>
    <updated>2012-08-22T02:15:00+01:00</updated>
    <id>http://blog.wjlr.org.uk/2012/08/22/ludum-dare-24-i-slash-m-taking-part</id>
    <content type="html"><![CDATA[<p>I shall be making an attempt to build a game in 48 hours for <a href="http://www.ludumdare.com/compo/">Ludum Dare 24</a>, for the first time.</p>

<p>My tools will be:</p>

<ul>
<li><strong>Language</strong>: Clojure + ClojureScript (targeting Javascript)</li>
<li><strong>Engine</strong>: My brain and HTML Canvas&#8230;mainly canvas</li>
<li><strong>Libraries</strong>: probably at least <a href="https://github.com/ibdknox/monet">Monet</a></li>
<li><strong>Music</strong>: I have no idea, whatever I can work out how to use</li>
<li><strong>Graphics</strong>: Pixen, Pixelmator, that sort of thing probably</li>
</ul>


<p>I&#8217;m gonna have fun but since I&#8217;m breaking rule 1 - know the tools (I don&#8217;t know any possible tools) this is going to be intense.</p>

<p>Have fun everyone!</p>
]]></content>
  </entry>
  
</feed>
